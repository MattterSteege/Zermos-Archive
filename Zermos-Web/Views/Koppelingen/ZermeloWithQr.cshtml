@model dynamic

@{
    ViewBag.Title = "title";
    Layout = "_Layout";
}

<script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.4/html5-qrcode.min.js" integrity="sha512-k/KAe4Yff9EUdYI5/IAHlwUswqeipP+Cp5qnrsUjTPCgl51La2/JhyyjNciztD7mWNKLSXci48m7cctATKfLlQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<style>
    main {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #reader {
        width: 600px;
    }
    #result {
        text-align: center;
        font-size: 1.5rem;
    }
</style>
<main>
    <div id="reader"></div>
    <div id="result"></div>
</main>
<script>
const scanner = new Html5QrcodeScanner('reader', {
    qrbox: {
        width: 250,
        height: 250,
    },
    fps: 20,
    facingMode: { exact: "environment"}
});
scanner.render(success, error);

function success(result) {
    //POST to /Koppelingen/Zermelo/Qr?code=['code' from json]
    
    code = JSON.parse(result).code;    
    document.getElementById('reader').remove();
    scanner.clear();
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/Koppelingen/Zermelo/Code?code=" + code, true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    
    xhr.onreadystatechange = function() {
        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
            //follow redirect
            
           window.location.href = this.responseURL;
        }
    }
    
    xhr.send();        
}

function error(err) {
    console.error(err);
}
</script>