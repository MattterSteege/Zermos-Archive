@model string


<link rel="stylesheet" href="/css/koppelingen.css" preload/>

<script minimize>
@Context.Items["dmjs"]

var firstModal = new ZermosModal()
.addHeading({text: "Koppel Infowijs aan je account!"})
.addText({text: "Om Infowijs te koppelen aan je account, moet je eerst je schoolmail invullen. Je krijgt dan een mail met een knop, als je op die knop klikt wordt je doorgestuurd naar infowijs, je krijgt een groen vinkje te zien met de tekst '<b>Gelukt!</b>'. Als je dit ziet, open Zermos dan weer en klik op de knop 'check of je ingelogd bent' die dadelijk hieronder verschijnt.", asHtml: true})
.addLabel({text: "Schoolmail"})
.addTextInput({required: true})
.addButton({text: "Stuur mij de email", onClick: (ctx) => {
    var email = ctx.getComponentsValue().values[0].value;

        fetch("@Url.Action("InfowijsWithEmail", "Koppelingen")?email=" + email, {
        method: "POST",
        body: JSON.stringify({email: email}),
    })
    .then((res) => res.json())
    .then((json) => {
        var email = json.email;
        var customer_product_id = json.customer_product_id;
        var user_id = json.user_id;
        var id = json.id;

        new ZermosModal()
        .addHeading({text: "Koppel Infowijs aan je account!"})
        .addText({text: "Er is een mail gestuurd naar <b id='email-text'>" + email + "</b>, deze mail is namens 'Antonius(noreply@mailer.hoyapp.nl)' gestuurd. Klik op de knop in de mail, je krijgt een groen vinkje te zien met de tekst '<b>Gelukt!</b>'. Als je dit ziet, open Zermos dan weer en klik op de knop 'check of je ingelogd bent' hieronder", asHtml: true})
        .addButton({text: "Check of je ingelogd bent", onClick: () => {
        
            fetch("@Url.Action("InfowijsWithEmail", "Koppelingen")?customer_product_id=" + customer_product_id + "&user_id=" + user_id + "&id=" + id, {
                method: "POST",
                body: JSON.stringify({customer_product_id: customer_product_id, user_id: user_id, id: id}),
            })
            .then((res) => res.text())
            .then((text) => {
                if(text === "success") {
                    newSidebar();
                    ReplacePage("@Url.Action("Account", "Account")");
                }
            })
            
        }})
        .openTroughAppending(main);
        
        firstModal.close();
    })
}})
.openTroughAppending(main);



</script>