@model string

<link rel="stylesheet" href="/css/koppelingen.css" preload/>

<script minimize>
@Context.Items["dmjs"]

var modal = new ZermosModal()
.addHeading({text: "Vul hier je schoolmail in."})
.addHeading({text: "Scan deze code met de QR code scanner in de antonius app (Antonius app > Meer > Hoy Scan) en je bent ingelogd!"})
.addImage({src: "https://api.qrserver.com/v1/create-qr-code/?size=360x360&data=@(ViewData["qr_text"])", alt: "qr code"})
.addButton({text: "Koppel Infowijs", onClick: () => {
    SendCheck();
}, id: "submit-button"})
.openTroughAppending(main);

var CheckingTimeout = setTimeout(function() {
    SendCheck();
}, 10000);

Zermos.mainUnload = () => {
    clearTimeout(CheckingTimeout);
};

function SendCheck() {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "@Url.Action("InfowijsQr", "Koppelingen", new { uuid = ViewData["uuid"]})");
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                if (xhr.responseText === "success") {
                    clearInterval(CheckingTimeout);
                    newSidebar();
                    ReplacePage('@Url.Action("Account", "Account")');
                } else {
                    CheckingTimeout = setTimeout(function() {
                        SendCheck();
                    }, 2500);
                }
            }
            else {
                CheckingTimeout = setTimeout(function() {
                    SendCheck();
                }, 2500);
            }
        }
    };
    xhr.send();
}
</script>