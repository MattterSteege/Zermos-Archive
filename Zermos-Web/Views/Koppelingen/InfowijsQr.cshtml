@model string

@{
    ViewBag.Title = "title";
}

<link rel="stylesheet" href="~/css/koppelingen.css" />

<div class="login">
    <div class="login-explanation">
        <p>Vul hier je schoolmail in.</p>
        <p>Scan deze code met de QR code scanner in de antonius app (Antonius app > Meer > Hoy Scan), klik daarna op 'check of je ingelogd bent' en je bent ingelogd!</p>
        <img onload="imageLoaded()" src="https://chart.googleapis.com/chart?cht=qr&chl=@(ViewData["qr_text"])&chs=360x360&choe=UTF-8&chld=L|0" alt="qr code" class="img-thumbnail">
        <div class="loading-icon">
            <img src="/images/Loading-Icon-by-Kanggraphic-27-580x386-removebg-preview.png" >
        </div>
    </div>
    <form method="post" asp-controller="Koppelingen" asp-action="InfowijsQr" asp-route-uuid="@ViewData["uuid"]" class="form-control" asp-route-retry="true">
        <button class="input submit" type="submit" id="check">Check @((bool)ViewData["retry"]! ? "opnieuw" : "") of je ingelogd bent</button>
    </form>
</div>

<script>
    function imageLoaded() {
        var loadingIcon = document.getElementsByClassName("loading-icon")[0];
        loadingIcon.style.display = "none";  
    }

    //when user submits the form, use the function below to check if the user is logged in
    document.getElementsByTagName("form")[0].addEventListener("submit", function (e) {
        e.preventDefault();
        var form = document.getElementsByTagName("form")[0];
        var button = document.getElementById("check");
        button.innerHTML = "Bezig met laden...";
        button.disabled = true;
        var xhr = new XMLHttpRequest();
        xhr.open("POST", form.action);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    if (xhr.responseText === "success") {
                        ReplacePage('@Url.Action("Account", "Account")');
                    }
                    else {
                        button.innerHTML = "Check opnieuw of je ingelogd bent";
                        button.disabled = false;
                    }
                }
            }
        };
        xhr.send();
    });
</script>