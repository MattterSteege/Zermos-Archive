@using Zermos_Web.Models.Zermos
@model Zermos_Web.Models.Zermos.NotitiesModel

@{
    ViewBag.Title = "title";
    Model.NotitieBoeken = Model.NotitieBoeken.OrderBy(x => x.Naam).ToList();
}

<link rel="stylesheet" href="/css/notities.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<div class="actions-row" style="height: 0; margin-bottom: 0;">
    <div id="change-name" onclick="UpdateName(document.querySelector('.selected').getAttribute('note-id'))">
        <i class="fa-solid fa-edit"></i>
        Naam wijzigen
    </div>
    <div id="delete" onclick="deleteNotebook(document.querySelector('.selected').getAttribute('note-id'))">
        <i class="fa-solid fa-trash"></i>
        Verwijderen
    </div>
    <div onclick="alert('Deze functie is nog niet geimplementeerd')">
        <i class="fa-solid fa-file-export"></i>
        Exporteren
    </div>
</div>

<table class="table">
    <tr class="table-header">
        <th scope="col" style="width: 0;"></th>
        <th scope="col" style="width: 0;"><i class="fa-solid fa-file"></i></th>
        <th scope="col">Notitieboek naam</th>
        <th scope="col">Notities</th>
        <th scope="col">Laatst aangepast</th>
    </tr>

    @foreach (NotitieBoek notitieBoek in Model.NotitieBoeken)
    {
        string url = "/Notities/" + notitieBoek.Id;

        <tr class="table-row" note-id="@notitieBoek.Id">
            <td><i class="fa-regular fa-circle"></i></td>
            <td><i class="fa-solid fa-folder"></i></td>
            <td class="notitieboek-naam" onclick="ReplacePage('@url')">@notitieBoek.Naam</td>
            <td>@notitieBoek.Notities.Count</td>
            <td>@notitieBoek.lastEdit.ToString("dd/MM/yyyy")</td>
        </tr>
    }
</table>


<script>
var selectable = document.getElementsByClassName('fa-circle');

for (var i = 0; i < selectable.length; i++) {
    selectable[i].onclick = function() {
        if (this.classList.contains('fa-circle')) {
            document.querySelectorAll('.fa-check-circle').forEach(element => {
                element.classList.remove('fa-check-circle');
                element.classList.add('fa-circle');
                element.parentElement.parentElement.classList.remove('selected');
            });

            this.classList.remove('fa-circle');
            this.classList.add('fa-check-circle');
            this.parentElement.parentElement.classList.add('selected');

            document.querySelector('.actions-row').style.height = "";
            document.querySelector('.actions-row').style.marginBottom = "";
        } else {
            this.classList.remove('fa-check-circle');
            this.classList.add('fa-circle');
            this.parentElement.parentElement.classList.remove('selected');
            document.querySelector('.actions-row').style.height = "0";
            document.querySelector('.actions-row').style.marginBottom = "0";
        }
    };
}

function deleteNotebook(uuid) {
    new ZermosModal()
    .setTitle("Notitieboek verwijderen")
    .addText("Weet je zeker dat je dit notitieboek wilt verwijderen? Vul de naam van het notitieboek in om te bevestigen.")
    .addInput(document.querySelector('.selected .notitieboek-naam').innerText)
    .setSubmitButtonLabel("Verwijderen")
    .onSubmit((input) => {
        if (input === document.querySelector('.selected .notitieboek-naam').innerText) {   
            fetch('@Context.Request.Path/' + uuid, {
                    method: 'DELETE'
                }).then(response => {
                    if (response.status === 200) {
                        ReplacePage('/Notities');
                    }
                }).catch(error => {
                    console.error(error);
                });
        }
    })
    .open();
}

function UpdateName(uuid) {
    new ZermosModal()
    .setTitle("Naam wijzigen")
    .addInput("Wat wil je dat de nieuwe naam wordt?")
    .setSubmitButtonLabel("Naam wijzigen")
    .onSubmit((name) => {
        fetch('@Context.Request.Path/' + uuid, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({Naam: name})
            }).then(response => {
                if (response.status === 200) {
                    ReplacePage('/Notities');
                }
            }).catch(error => {
                console.error(error);
            });
    })
    .open();
}
    
addButtonToPage('fa-plus', AddNotebook)

function AddNotebook() {
     new ZermosModal()
    .setTitle("Nieuw notitieboek")
    .addInput("Wat wil je dat de nieuwe naam wordt?")
    .setSubmitButtonLabel("Naam wijzigen")
    .onSubmit((naam) => {
        fetch('@Context.Request.Path', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({Naam: naam})
        }).then(response => {
            if (response.status === 200) {
                ReplacePage('/Notities');
            }
        }).catch(error => {
            console.error(error);
        });
    })
    .open();
};
</script>
