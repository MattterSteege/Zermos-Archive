@using System.Globalization
@using Zermos_Web.Models.zermelo
@using Zermos_Web.Utilities
@model Zermos_Web.Models.zermelo.ZermeloRoosterModel

@{
    ViewData["title"] = "title";
}

<link rel="stylesheet" href="/css/zermelo.css" />
<script src="/js/dom-to-image.js"></script>

<div class="main-container">
    <div class="week-carousel" id="week-carousel">
        @(await Html.PartialAsync("Rooster-week", Model))
    </div>
</div>

<script>
function OpenLessonDetail(base64){
    const json = JSON.parse(atob(base64));
    
    var lessonDetail = new ZermosModal()
    .setTitle((json.subjects[0] ?? '?') + " - " + new Date(json.start * 1000).toLocaleDateString("nl-NL", { weekday: 'long', month: 'short', day: 'numeric'}));
    
        lessonDetail.addText("Degene die dit rooster gedeeld heeft:");
    if (json.teachers.length > 0) 
        lessonDetail.addText("• heeft les van " + json.teachers.join(", ") + ".");
    if (json.locations.length > 0) 
        lessonDetail.addText("• in lokaal " + json.locations.join(", ") + ".");
    if (json.groups.length > 0) 
        lessonDetail.addText("• met groep " + json.groups.join(", ") + ".");   
    
    lessonDetail.addText("De les is van: " + new Date(json.start * 1000).toLocaleDateString("nl-NL", {hour: '2-digit', minute:'2-digit'}).split(" ")[1] + " tot " + new Date(json.end * 1000).toLocaleDateString("nl-NL", {hour: '2-digit', minute:'2-digit'}).split(" ")[1])
    .hideSubmitButton();
    
    for (var i = 0; i < json.status.length; i++) {
        var status = json.status[i];

        if (status['code'] === 2002) continue;
        
        lessonDetail.addText("• " + status.nl);
    }
    
    lessonDetail.open();
}
</script>