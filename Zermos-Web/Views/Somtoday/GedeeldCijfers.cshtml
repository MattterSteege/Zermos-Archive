@using Zermos_Web.TagHelpers
@using Zermos_Web.Utilities
@model Zermos_Web.Models.SortedSomtodayGradesModel.SortedSomtodayGradesModel

@{
    float cijferSEAverage = 0;
    int cijferSECount = 0;
}

<link rel="stylesheet" href="/css/somtoday.css" preload/>

<!--  Create 2 equal sized panels, left should be grades and SE grades both with a slider at the top to select which one, the right the last x grades ->
<!- When the screen is less then 100px wide, the all the panels should be combined into one panel, with 3 options at the slider at the top    -->


<div class="grade-controls">
    <div id="togglePanel1">Rapport</div>
    <div id="underline" style="left: -100px; width: 0"></div>
</div>
<div class="grades-container">
    <div id="panel1" class="panel" style="display: flex;"> <!-- Voortgangsdossier -->
        <h1 class="grades-title">Voortgangsdossier</h1>
        @foreach (var grade in Model.items)
        {
            if (grade.cijfer == "-") { continue; }

            <table class="grade-table">
                <tr class="grade-table-header">
                    <td rowspan="2"><i class="fa-solid fa-book" data-name="@grade.vakNaam.ToLower()" data-name-short="@grade.vakAfkorting.ToLower()"></i></td>
                    <td>@grade.vakNaam.Capitalize()</td>
                    <td></td>
                    <td class="@(grade.cijfer.ToFloat() >= 5.45f ? "sufficient" : "insufficient ")">@grade.cijfer.Replace(",", ".")</td>
                    <td style="display: none" class="@(grade.cijfer.ToFloat() >= 5.45f ? "sufficient" : "insufficient ")">@grade.cijfer.ToFloat().ExamenAfronding()</td>
                </tr>
                <tr class="grade-table-header">
                    <td style="display: none"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        }
        
        <table class="grade-table">
            <tr class="grade-table-header">
                <td colspan="2">Totaalgemiddelde</td>
                <td></td>
                <td class="@(Model.voortGangsdossierGemiddelde >= 5.45 ? "sufficient" : "insufficient ")">~ @(Model.voortGangsdossierGemiddelde.ToString().Replace(",", "."))</td>
            </tr>
        </table>
    </div>
</div>
<script minimize>
@Context.Items["dmjs"]
    Zermos.mainAfterLoad = () => {
        
        const selectedButton = buttons[0];
        if (selectedButton) {
            const buttonRect = selectedButton.getBoundingClientRect();
            const containerRect = selectedButton.parentElement.getBoundingClientRect();

            underline.style.width = `${buttonRect.width}px`;
            underline.style.left = `${buttonRect.left - containerRect.left}px`;
        }
    };

    //get all the icons at /vakkenIcons.json
    fetch('/vakkenIcons.json')
    .then(response => response.json())
    .then((icons) => {
        //get all the icons and put them in a map
        var iconMap = new Map();
        icons.forEach(icon => {
            icon.keywords.forEach(keyword => {
                iconMap.set(keyword, icon.icon);
            });
        });

        //check if the name-short or name is in the iconMap, if it is, set the icon to the iconMap value, if not, set it to the default icon
        document.querySelectorAll('.grade-table-header i').forEach((icon) => {
            icon.outerHTML = iconMap.get(icon.dataset.name?.toLowerCase()) ?? iconMap.get(icon.dataset.nameShort?.toLowerCase()) ?? "<i class=\"fa-solid fa-book\"></i>";
        });
    });

</script>