@using System.Globalization
@using Wangkanai.Extensions
@model Zermos_Web.Models.somtodayHomeworkModel.somtodayHomeworkModel

@{
    ViewBag.Title = "title";


    var groupedHomework = Model.items.GroupBy(item => item.datumTijd.Day);
}

<div class="homework-container">
    @foreach (var dayGroup in groupedHomework)
    {
        <div class="homework-day-parent">

            <h1>@(dayGroup.First()?.datumTijd.ToString("dddd dd MMMM", new CultureInfo("nl-NL")) ?? "Geen datum!?")</h1>

            @foreach (var homeworkItem in dayGroup)
            {
                <div class="homeworkItem @homeworkItem.studiewijzerItem.huiswerkType?.ToLower() @(homeworkItem.studiewijzerItem.bijlagen?.Count > 0 ? "bijlagen" : "")">
                    <div class="homeworkItem-top">
                        <p style="width: fit-content;"><b>@homeworkItem.lesgroep.vak.naam</b> @(homeworkItem.studiewijzerItem.onderwerp.IsNullOrEmpty() ? "" : " - " + homeworkItem.studiewijzerItem.onderwerp)</p>
                        
                        @if (!homeworkItem.studiewijzerItem.omschrijving.IsNullOrEmpty())
                        {
                            <div class="homework-divider"></div>
                            <div class="homework-content">@Html.Raw(homeworkItem.studiewijzerItem.omschrijving)</div>
                        }

                    </div>
                </div>
            }
        </div>
    }
</div>

@if (Model.items.Count == 0)
{
    <h1 style="position: relative; top: 50%; width: 100%; transform: translate(0, -50%); text-align: center; color: var(--text-color);">Geen huiswerk, nice!</h1>
}

<div class="bottom-right-add-button">
    <a asp-controller="Somtoday" asp-action="NieuwHuiswerk">
        <i class="fa-solid fa-plus center"></i>
    </a>
</div>

<script>
  // Get all the div elements with class "homework-divider"
  const dividers = document.querySelectorAll('.homework-divider');

  // Loop through each divider element
  dividers.forEach(divider => {
    // Get the sibling p element
    const siblingParagraph = divider.previousElementSibling;

    // Check if the sibling exists and is a p element
    if (siblingParagraph && siblingParagraph.tagName === 'P') {
      // Get the width of the sibling paragraph
      const width = siblingParagraph.offsetWidth;
      
      // Set the width of the divider to match the width of the paragraph
      divider.style.width = `${width + 14}px`;
    }
  });
</script>